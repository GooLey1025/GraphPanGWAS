/*
========================================================================================
    Default parameter values ========================================================================================
*/

params {
    // Input files (required - must be set by user)
    population_list       = null
    phenotypes_dir        = null
    output_prefix         = null
    analysis_type         = 'all'  // Default: run all analysis types
    
    // VCF input files (at least one required)
    snp_vcf              = null
    indel_vcf            = null
    sv_vcf               = null
    
    // Tool paths (default assumes tools are in PATH)
    gemma                = 'gemma-0.98.5-linux-static-AMD64'
    plink                = 'plink'
    gcta                 = 'gcta64'
    bcftools             = 'bcftools'
    bgzip                = 'bgzip'
    python3              = 'python3'
    perl                 = 'perl'
    awk                  = 'awk'
    
    // GWAS parameters
    max_parallel_gwas    = 5
    maf_threshold        = 0.01
    miss_threshold       = 0.2
    hwe_threshold        = 0
    
    // PLINK memory
    plink_memory         = 10000
    
    // GEMMA parameters
    gemma_lmm_type       = 1  // 1: Wald test, 2: likelihood ratio test, 3: score test, 4: all
    
    // Clumping parameters
    clump_p1             = 1e-6
    clump_p2             = 0.05
    clump_r2             = 0.1
    clump_kb             = 1000
    
    // GCTA parameters
    gcta_threads         = 10
    
    // VCF preprocessing parameters
    bcftools_threads     = 20
    bgzip_threads        = 50
    
    // Chromosome mapping for VCF preprocessing (rice-specific)
    chr_prefix           = 'FaHC_P8_Nipponbare_TEJ#0#P8.Nipponbare.TEJ.Chr'
    num_chromosomes      = 12
    
    // Working directories
    tmp_vcf_dir          = 'tmp_vcf_dir'
    raw_vcf_dir          = 'raw_vcf_dir'
    vcf_dir              = 'vcf_dir'
    
    // Output directories
    heritability_dir     = 'heritability'
    lead_marker_dir      = 'Lead_marker'
    
    // Pipeline info
    help                 = false
    
    // Max resource limits (can be adjusted per cluster)
    max_cpus             = 40
    max_memory           = 128.GB
    max_time             = 72.h
}

// Validate required parameters
def validateParams() {
    def errors = []
    
    if (!params.population_list) {
        errors<< "Missing required parameter: --population_list"
    }
    if (!params.phenotypes_dir) {
        errors << "Missing required parameter: --phenotypes_dir"
    }
    if (!params.output_prefix) {
        errors << "Missing required parameter: --output_prefix"
    }
    if (!params.analysis_type) {
        errors << "Missing required parameter: --analysis_type"
    }
    if (!params.snp_vcf && !params.indel_vcf && !params.sv_vcf) {
        errors << "At least one VCF file must be provided (--snp_vcf, --indel_vcf, or --sv_vcf)"
    }
    
    if (errors.size() > 0) {
        log.error "Parameter validation failed:"
        errors.each { log.error "  - ${it}" }
        log.error "\nRun with --help for usage information"
        System.exit(1)
    }
}

