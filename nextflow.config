/*
========================================================================================
    GraphPanGWAS Nextflow Configuration ========================================================================================
*/

// Import configuration files
includeConfig 'conf/base.config'
includeConfig 'conf/params.config'

// Define configuration profiles
profiles {
    local {
        includeConfig 'conf/local.config'
    }
    slurm {
        includeConfig 'conf/slurm.config'
    }
    standard {
        includeConfig 'conf/local.config'
    }
}

// Global settings
manifest {
    name            = 'GraphPanGWAS'
    author          = 'GWAS Pipeline Team'
    homePage        = 'https://github.com/your-repo/GraphPanGWAS'
    description     = 'GWAS analysis pipeline for pangenome variants (SNP, INDEL, SV)'
    mainScript      = 'main.nf'
    nextflowVersion = '>=22.10.0'
    version         = '1.0.0'
}

// Workflow execution settings
workflow {
    name = 'GraphPanGWAS'
}

// Pipeline execution reports
timeline {
    enabled = true
    file    = "${params.output_prefix}/pipeline_info/execution_timeline.html"
}

report {
    enabled = true
    file    = "${params.output_prefix}/pipeline_info/execution_report.html"
}

trace {
    enabled = true
    file    = "${params.output_prefix}/pipeline_info/execution_trace.txt"
}

dag {
    enabled = true
    file    = "${params.output_prefix}/pipeline_info/pipeline_dag.svg"
}

// Default parameter values (can be overridden)
params {
    // Help message
    help = false
    
    // Output directory
    outdir = './results'
}

// Function to print help message
def helpMessage() {
    log.info """ ========================================
    GraphPanGWAS Pipeline - Usage
    ========================================
    
    Required Arguments:
      --population_list       Path to population sample list file
      --phenotypes_dir        Directory containing phenotype TSV files
      --output_prefix         Output directory prefix
      --analysis_type         Analysis type name (e.g., SNP_INDEL_SV_split)
    
    VCF Input (at least one required):
      --snp_vcf              SNP VCF file path
      --indel_vcf            INDEL VCF file path
      --sv_vcf               SV VCF file path
    
    Optional Arguments:
      --max_parallel_gwas    Maximum parallel GWAS jobs (default: 5)
      --maf_threshold        Minor allele frequency threshold (default: 0.01)
      --miss_threshold       Missing rate threshold (default: 0.2)
      --clump_p1            Clumping p-value threshold (default: 1e-6)
      --clump_r2            Clumping r2 threshold (default: 0.1)
      --clump_kb            Clumping window size in kb (default: 1000)
    
    Tool Paths:
      --gemma               Path to GEMMA executable
      --plink               Path to PLINK executable
      --gcta                Path to GCTA64 executable
      --bcftools            Path to bcftools executable
    
    Execution Profiles:
      -profile local        Run on local machine
      -profile slurm        Run on SLURM cluster
    
    Example Usage:
      nextflow run main.nf \\
        --population_list 532rice.list \\
        --snp_vcf raw_vcf_dir/532rice.snp.impute.vcf \\
        --indel_vcf raw_vcf_dir/532rice.indel.impute.vcf \\
        --sv_vcf raw_vcf_dir/532rice.pangenie.multi.impute.vcf \\
        --phenotypes_dir ./phenotypes/532rice \\
        --output_prefix 532rice \\
        --analysis_type SNP_INDEL_SV_split \\
        -profile slurm
    
    ========================================
    """
}

// Show help message if requested
if (params.help) {
    helpMessage()
    exit 0
}

